-- Tabla CIUDAD
CREATE TABLE CIUDAD (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOMBRE VARCHAR2(100) NOT NULL,
    CODIGO VARCHAR2(10) NOT NULL
);

-- Tabla SUCURSAL (Asociada a una CIUDAD)
CREATE TABLE SUCURSAL (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOMBRE VARCHAR2(100) NOT NULL,
    CIUDAD_ID NUMBER NOT NULL,
    DIRECCION VARCHAR2(255),
    TELEFONO VARCHAR2(20),
    CONSTRAINT FK_CIUDAD FOREIGN KEY (CIUDAD_ID) REFERENCES CIUDAD(ID)
);

-- Tabla BODEGA (Asociada a una SUCURSAL)
CREATE TABLE BODEGA (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOMBRE VARCHAR2(100) NOT NULL,
    TAMANO NUMBER NOT NULL,  -- Capacidad de la bodega en volumen
    SUCURSAL_ID NUMBER NOT NULL,
    CONSTRAINT FK_SUCURSAL_BODEGA FOREIGN KEY (SUCURSAL_ID) REFERENCES SUCURSAL(ID)
);

-- Tabla CATEGORIA_PRODUCTO
CREATE TABLE CATEGORIA_PRODUCTO (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOMBRE VARCHAR2(100) NOT NULL,
    DESCRIPCION VARCHAR2(255),
    CARACTERISTICAS_ALMACENAMIENTO VARCHAR2(255)
);

-- Tabla PRODUCTO (Asociado a una categoría)
CREATE TABLE PRODUCTO (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOMBRE VARCHAR2(100) NOT NULL,
    COSTO_BODEGA NUMBER NOT NULL,
    PRECIO_UNITARIO NUMBER NOT NULL,
    PRESENTACION VARCHAR2(50) NOT NULL,
    CANTIDAD_PRESENTACION NUMBER NOT NULL,
    UNIDAD_MEDIDA VARCHAR2(50) NOT NULL,
    VOLUMEN_EMPAQUE NUMBER,
    PESO_EMPAQUE NUMBER,
    FECHA_EXPIRACION DATE,
    CODIGO_BARRAS VARCHAR2(50) UNIQUE,
    CATEGORIA_ID NUMBER,
    CONSTRAINT FK_CATEGORIA FOREIGN KEY (CATEGORIA_ID) REFERENCES CATEGORIA_PRODUCTO(ID)
);

-- Tabla PROVEEDOR
CREATE TABLE PROVEEDOR (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NIT VARCHAR2(50) NOT NULL UNIQUE,
    NOMBRE VARCHAR2(100) NOT NULL,
    DIRECCION VARCHAR2(255),
    NOMBRE_CONTACTO VARCHAR2(100),
    TELEFONO_CONTACTO VARCHAR2(20)
);

-- Tabla ORDEN_DE_COMPRA (Encabezado)
CREATE TABLE ORDEN_DE_COMPRA (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FECHA_CREACION DATE DEFAULT SYSDATE NOT NULL,
    FECHA_ESPERADA_ENTREGA DATE NOT NULL,
    ESTADO VARCHAR2(50) DEFAULT 'vigente' CHECK (ESTADO IN ('vigente', 'anulada', 'entregada')),
    SUCURSAL_ID NUMBER NOT NULL,
    PROVEEDOR_ID NUMBER NOT NULL,
    CONSTRAINT FK_SUCURSAL_ORDEN FOREIGN KEY (SUCURSAL_ID) REFERENCES SUCURSAL(ID),
    CONSTRAINT FK_PROVEEDOR_ORDEN FOREIGN KEY (PROVEEDOR_ID) REFERENCES PROVEEDOR(ID)
);

-- Tabla ORDEN_DE_COMPRA_DETALLE (Detalle de la orden)
CREATE TABLE ORDEN_DE_COMPRA_DETALLE (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ORDEN_ID NUMBER NOT NULL,
    PRODUCTO_ID NUMBER NOT NULL,
    PRECIO_PRODUCTO NUMBER NOT NULL,
    CANTIDAD_PRODUCTO NUMBER NOT NULL,
    CONSTRAINT FK_ORDEN FOREIGN KEY (ORDEN_ID) REFERENCES ORDEN_DE_COMPRA(ID),
    CONSTRAINT FK_PRODUCTO FOREIGN KEY (PRODUCTO_ID) REFERENCES PRODUCTO(ID)
);

-- Tabla PRODUCTO_BODEGA (Inventario de productos en bodegas específicas)
CREATE TABLE PRODUCTO_BODEGA (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BODEGA_ID NUMBER NOT NULL,
    PRODUCTO_ID NUMBER NOT NULL,
    CANTIDAD_ACTUAL NUMBER NOT NULL,
    CANTIDAD_MINIMA NUMBER NOT NULL,
    CONSTRAINT FK_BODEGA FOREIGN KEY (BODEGA_ID) REFERENCES BODEGA(ID),
    CONSTRAINT FK_PRODUCTO_BODEGA FOREIGN KEY (PRODUCTO_ID) REFERENCES PRODUCTO(ID)
);
